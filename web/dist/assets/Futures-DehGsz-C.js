import{r as n,j as e,X as Y,B as L,h as t,H as c,Y as p,b as m,Z as ne,g as pe,$ as we,G as Q,a0 as ze,V as N,M as W,S as ke,L as Te,a1 as I,a2 as ue,J as he}from"./ui-CpDg7456.js";import{T as G,u as $e,a as Le,B as Qe,P as Ne,O as Fe,D as le,b as qe}from"./useSymbolStats-CU4nm1Xq.js";import{e as Ae,a as Be,d as Oe,f as Ee,A as D,n as v}from"./index-BfGfRh_G.js";import{c as ae,f as xe}from"./utils-pQFqaaI3.js";import"./vendor-OvXVS5lI.js";import"./charts-D8q9aCF-.js";const me=n.memo(({token:S,quote:a,isAuthed:F,available:d,futuresPositions:M,onPlaceOrder:B,onClosePosition:H,onTransferClick:O,loadingOrder:_})=>{const[P,C]=n.useState(""),[k,w]=n.useState("10"),[T,R]=n.useState("market"),[j,X]=n.useState(""),[h,Z]=n.useState("open"),[q,K]=n.useState(0),[J,b]=n.useState(!1),[z,$]=n.useState("10");n.useEffect(()=>{if(h==="open"&&q>0){const l=parseFloat(d),f=Number(k||1),o=(l*f*q/100).toFixed(8).replace(/\.?0+$/,"");o!==P&&C(o)}},[q,k,h,d]);const E=n.useCallback(l=>{B(l,P,T,j,k),C("")},[P,T,j,k,B]),ee=n.useCallback(()=>{H(`${S}_${a}`,P)},[S,a,P,H]),se=n.useCallback(l=>{if(K(l),h==="close"){const f=M.find(o=>o.symbol===`${S}_${a}`);f&&C(l===100?f.quantity.toString():(f.quantity*l/100).toFixed(8).replace(/\.?0+$/,""))}},[h,M,S,a]);return e.jsxs(Y,{padding:0,withBorder:!0,radius:"md",h:1171,style:{overflowY:"auto"},shadow:"xs",children:[e.jsx(L,{bg:"var(--bg-2)",h:40,px:"md",style:{borderBottom:"1px solid var(--mantine-color-default-border)",display:"flex",alignItems:"center"},children:e.jsx(t,{size:"sm",fw:600,c:"dimmed",tt:"uppercase",style:{letterSpacing:"0.05em"},children:"Futures Trade"})}),e.jsxs(c,{direction:"column",gap:"md",p:"md",children:[e.jsx(p,{value:h,onChange:l=>Z(l),variant:"pills",radius:"md",color:"blue",children:e.jsxs(p.List,{grow:!0,children:[e.jsx(p.Tab,{value:"open",children:"Open"}),e.jsx(p.Tab,{value:"close",children:"Close"})]})}),h==="open"&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{variant:"default",fullWidth:!0,size:"sm",justify:"space-between",onClick:()=>{$(k),b(!0)},rightSection:e.jsx(t,{size:"xs",c:"dimmed",children:"Isolated"}),children:[k,"x"]}),e.jsx(ne,{opened:J,onClose:()=>b(!1),title:"Adjust Leverage",centered:!0,size:"xs",lockScroll:!1,children:e.jsxs(pe,{gap:"md",children:[e.jsx(we,{label:"Leverage",value:Number(z),onChange:l=>$(String(l)),max:500,min:1,size:"md",suffix:"x"}),e.jsx(Q,{gap:"xs",children:["10","20","50","100","500"].map(l=>e.jsxs(m,{size:"compact-sm",variant:z===l?"filled":"outline",color:z===l?"blue":"gray",onClick:()=>$(l),children:[l,"x"]},l))}),e.jsx(ze,{value:Number(z),onChange:l=>$(String(l)),max:500,min:1,step:1,label:l=>`${l}x`,marks:[{value:1,label:"1x"},{value:250,label:"250x"},{value:500,label:"500x"}]}),e.jsxs(Q,{grow:!0,mt:"md",children:[e.jsx(m,{variant:"light",color:"gray",onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{color:"blue",onClick:()=>{w(z),b(!1)},children:"Confirm"})]})]})})]}),e.jsx(p,{value:T,onChange:l=>R(l),variant:"pills",radius:"md",children:e.jsxs(p.List,{grow:!0,children:[e.jsx(p.Tab,{value:"market",children:"Market"}),e.jsx(p.Tab,{value:"limit",children:"Limit"})]})}),T==="limit"&&e.jsx(N,{label:"Limit Price",placeholder:"0.00",value:j,onChange:l=>X(l.currentTarget.value),size:"xs"}),h==="open"?e.jsxs(t,{size:"xs",c:"dimmed",children:["Available: ",Number(d).toLocaleString(void 0,{maximumFractionDigits:4})," ",a]}):e.jsxs(t,{size:"xs",c:"dimmed",children:["Position Available: ",(()=>{const l=M.find(f=>f.symbol===`${S}_${a}`);return l?`${Number(l.quantity).toLocaleString(void 0,{maximumFractionDigits:4})} ${S}`:`0 ${S}`})()]}),e.jsx(N,{label:h==="open"?`Quantity (${a})`:`Quantity (${S})`,placeholder:"0.00",value:P,onChange:l=>C(l.currentTarget.value),size:"xs"}),h==="open"&&e.jsxs(t,{size:"xs",c:"dimmed",mt:-8,children:["Est. Margin: ",e.jsxs(t,{component:"span",fw:600,c:"var(--mantine-color-text)",children:[(Number(P||0)/Number(k||1)).toFixed(2)," ",a]})]}),e.jsx(G,{value:q,onChange:se}),e.jsx(c,{gap:"md",children:h==="open"?e.jsxs(e.Fragment,{children:[e.jsx(m,{flex:1,color:"var(--green)",loading:_==="buy",onClick:()=>E("long"),disabled:!F,children:"Buy / Long"}),e.jsx(m,{flex:1,color:"var(--red)",loading:_==="sell",onClick:()=>E("short"),disabled:!F,children:"Sell / Short"})]}):e.jsx(m,{flex:1,color:"#fe445c",variant:"filled",onClick:ee,disabled:!F||!P,children:"Close Position"})}),e.jsx(m,{variant:"default",onClick:O,disabled:!F,children:"Transfer"}),e.jsx(m,{variant:"filled",color:"blue",radius:"md",onClick:()=>window.location.href="/deposit",children:"Deposit"}),!F&&e.jsx(t,{size:"xs",c:"dimmed",children:"Login to trade and see your balances."})]})]})});me.displayName="FuturesTradeForm";function Je(){const[S]=Ae(),a=(S.get("quote")||"USDT").toUpperCase(),F=(S.get("base")||"BTC").toUpperCase().trim().replace(/\s+/g,""),[d,M]=n.useState(F),[B,H]=n.useState(""),{futuresStats:O,listen:_,unlisten:P}=Be(),{isAuthed:C}=Oe(),{futuresAvailable:k,refreshBalances:w,futuresPositions:T,orders:R}=Ee(),{stats:j,loading:X}=$e("futures",d,a),h=n.useMemo(()=>{const s=new Map;return O.forEach(r=>{s.set(r.symbol,r),s.set(r.symbol.replace("_",""),r)}),s},[O]),[Z,q]=n.useState(null),[K,J]=n.useState(!1),[b,z]=n.useState(null),[$,E]=n.useState(""),[ee,se]=n.useState(0),[l,f]=n.useState(null),[o,A]=n.useState({tp:"",sl:"",tpQty:"",slQty:""}),[U,re]=n.useState({tp:0,sl:0}),te=n.useMemo(()=>{const s=O.filter(r=>typeof r.symbol=="string"&&r.symbol.endsWith(a)).map(r=>r.symbol.replace("_","").replace(a,""));return Array.from(new Set(s))},[O,a]),ge=n.useMemo(()=>{const s=B.trim().toLowerCase();return(s?te.filter(r=>r.toLowerCase().includes(s)):te).slice(0,500)},[te,B]),{availableIntervals:ye,interval:ie,setInterval:je}=Le({symbol:`${d}_${a}`,market:"futures"});n.useEffect(()=>(_("futures"),()=>P("futures")),[_,P]);const be=k?.[a]??"0",[fe,ve]=n.useState([]),V=async()=>{if(C)try{const s=await fetch(`${D}/api/futures/history`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});s.ok&&ve(await s.json())}catch{}};n.useEffect(()=>{V()},[C]);const Se=n.useCallback(async(s,r,i,u,y)=>{if(!(!C||!r)){q(s==="long"?"buy":"sell");try{const g=await fetch(`${D}/api/futures/orders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({symbol:`${d}_${a}`,side:s,type:i,quantity:r,leverage:y,price:i==="limit"?u:void 0})});if(g.ok)w();else{const x=await g.json();v.show({title:"Order Error",message:x.error||"Failed to place order",color:"red"})}}catch{v.show({title:"Error",message:"Network error",color:"red"})}finally{q(null)}}},[C,d,a,w]),Pe=n.useCallback(async s=>{try{const r=await fetch(`${D}/api/futures/orders/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(r.ok)w();else{const i=await r.json();v.show({title:"Cancel Error",message:i.error||"Failed to cancel",color:"red"})}}catch{v.show({title:"Error",message:"Network error",color:"red"})}},[w]),oe=n.useCallback(async(s,r)=>{try{const i=await fetch(`${D}/api/futures/close-position`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({symbol:s,quantity:r})});if(i.ok)w(),z(null),V();else{const u=await i.json();v.show({title:"Close Error",message:u.error||"Failed to close",color:"red"})}}catch{v.show({title:"Error",message:"Network error",color:"red"})}},[w,V]),Ce=async(s,r,i,u,y)=>{try{const g=await fetch(`${D}/api/futures/positions/tpsl`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({symbol:s,tpPrice:r||0,slPrice:i||0,tpQuantity:u||0,slQuantity:y||0})});if(g.ok)w(),f(null);else{const x=await g.json();v.show({title:"TP/SL Error",message:x.error||"Failed to update TP/SL",color:"red"})}}catch{v.show({title:"Error",message:"Network error",color:"red"})}},ce=s=>{f({symbol:s.symbol,totalQty:Number(s.quantity),tp:s.tpPrice,tpQty:s.tpQuantity,sl:s.slPrice,slQty:s.slQuantity}),A({tp:s.tpPrice>0?String(s.tpPrice):"",sl:s.slPrice>0?String(s.slPrice):"",tpQty:s.tpQuantity>0?String(s.tpQuantity):"",slQty:s.slQuantity>0?String(s.slQuantity):""}),re({tp:s.tpQuantity>0?Math.round(s.tpQuantity/s.quantity*100):0,sl:s.slQuantity>0?Math.round(s.slQuantity/s.quantity*100):0})};return e.jsxs(L,{children:[e.jsxs(c,{align:"center",gap:"lg",py:4,children:[e.jsxs(W,{shadow:"md",width:260,position:"bottom-start",withinPortal:!0,trigger:"hover",openDelay:0,closeDelay:50,transitionProps:{transition:"pop-top-left",duration:0,timingFunction:"ease"},children:[e.jsx(W.Target,{children:e.jsx(m,{variant:"transparent",size:"lg",h:56,px:"xs",bg:"transparent",children:e.jsxs(c,{direction:"column",align:"flex-start",lh:1.2,children:[e.jsxs(t,{size:"xl",fw:700,children:[d,a]}),e.jsx(t,{size:"xxs",c:"dimmed",fw:500,tt:"uppercase",style:{letterSpacing:"0.05em"},children:"Perpetual"})]})})}),e.jsxs(W.Dropdown,{children:[e.jsx(L,{p:"xs",children:e.jsx(N,{placeholder:"Search pair",value:B,onChange:s=>H(s.currentTarget.value),size:"xs"})}),e.jsx(ke.Autosize,{mah:320,mx:0,type:"auto",children:ge.map(s=>e.jsxs(W.Item,{onClick:()=>M(s),children:[s,"/",a]},s))})]})]}),e.jsx(c,{align:"center",style:{borderLeft:"1px solid var(--mantine-color-default-border)",paddingLeft:"24px"},children:X?e.jsx(Te,{size:"xs"}):e.jsxs(Q,{gap:24,children:[e.jsx(L,{children:e.jsx(L,{fs:"1.25rem",fw:700,children:e.jsx(Qe,{symbol:`${d}${a}`,market:"futures"})})}),e.jsxs(c,{direction:"column",children:[e.jsx(t,{size:"xs",c:"dimmed",fw:600,children:"24h Change"}),e.jsx(t,{size:"xs",fw:500,color:(Number(j?.change24h)||0)>=0?"var(--green)":"var(--red)",children:j?.change24h!=null?(Number(j.change24h)>=0?"+":"")+`${Number(j.change24h).toFixed(2)}%`:"-"})]}),e.jsxs(c,{direction:"column",children:[e.jsx(t,{size:"xs",c:"dimmed",fw:500,children:"24h High"}),e.jsx(t,{size:"xs",fw:600,children:j?.high24h??"-"})]}),e.jsxs(c,{direction:"column",children:[e.jsx(t,{size:"xs",c:"dimmed",fw:500,children:"24h Low"}),e.jsx(t,{size:"xs",fw:600,children:j?.low24h??"-"})]}),e.jsxs(c,{direction:"column",children:[e.jsx(t,{size:"xs",c:"dimmed",fw:500,children:"24h Volume"}),e.jsx(t,{size:"xs",fw:600,children:j?.volume24h?Number(j.volume24h).toLocaleString(void 0,{maximumFractionDigits:0}):"-"})]})]})})]}),e.jsxs(I,{gutter:"md",children:[e.jsx(I.Col,{span:{base:12,lg:10},children:e.jsxs(c,{direction:"column",gap:"md",children:[e.jsxs(I,{gutter:"md",columns:10,children:[e.jsx(I.Col,{span:{base:10,lg:8},children:e.jsx(Y,{padding:0,radius:"md",withBorder:!0,shadow:"xs",children:e.jsx(Ne,{symbol:`${d}_${a}`,interval:ie,height:630,market:"futures",orders:R.filter(s=>s.symbol===`${d}_${a}`&&s.status==="pending"),positions:T.filter(s=>s.symbol===`${d}_${a}`),onClosePosition:s=>z({symbol:s.symbol,totalQty:Number(s.quantity)}),onIntervalChange:je,availableIntervals:ye},`${d}_${a}-${ie}-futures`)})}),e.jsx(I.Col,{span:{base:10,lg:2},children:e.jsxs(Y,{padding:0,radius:"md",withBorder:!0,shadow:"xs",h:630,children:[e.jsx(L,{bg:"var(--bg-2)",h:40,px:"md",style:{borderBottom:"1px solid var(--mantine-color-default-border)",display:"flex",alignItems:"center"},children:e.jsx(t,{size:"sm",fw:600,c:"dimmed",tt:"uppercase",style:{letterSpacing:"0.05em"},children:"Order Book"})}),e.jsx(L,{h:600,style:{overflowY:"auto"},children:e.jsx(Fe,{symbol:`${d}_${a}`,market:"futures",depth:12})})]})})]}),e.jsx(Y,{padding:0,withBorder:!0,radius:"md",h:525,style:{overflowY:"auto"},shadow:"xs",children:e.jsxs(p,{defaultValue:"positions",variant:"pills",radius:"md",children:[e.jsxs(p.List,{pt:4,px:4,children:[e.jsx(p.Tab,{value:"positions",children:"Positions"}),e.jsx(p.Tab,{value:"orders",children:"Open Orders"}),e.jsx(p.Tab,{value:"history",onClick:V,children:"Position History"})]}),e.jsx(p.Panel,{value:"positions",p:0,children:e.jsx(le,{data:T,emptyMessage:"No active positions",columns:[{label:"Trading Pair",key:"symbol",render:s=>e.jsxs(c,{direction:"column",lh:1.2,gap:0,children:[e.jsx(t,{size:"sm",fw:700,children:ae(s.symbol)}),e.jsxs(Q,{gap:2,children:[e.jsxs(t,{size:"xxs",c:"dimmed",fw:500,children:[s.leverage,"x"]}),e.jsx(t,{size:"xxs",color:s.side==="long"?"var(--green)":"var(--red)",fw:700,tt:"uppercase",children:s.side})]})]})},{label:"Size (Qty)",key:"quantity",render:s=>Number(s.quantity).toFixed(4)},{label:"Avg Entry Price",key:"entryPrice"},{label:"Margin",key:"margin",render:s=>`${Number(s.margin||0).toFixed(2)} ${a}`},{label:"Liq. Price",key:"liquidationPrice",render:s=>e.jsx(t,{size:"sm",c:"var(--liq)",fw:600,children:s.liquidationPrice?Number(s.liquidationPrice).toFixed(2):"-"})},{label:"Unrealized PNL",key:"pnl",render:s=>{const r=h.get(s.symbol)||h.get(s.symbol.replace("_",""))||h.get(s.symbol+a),i=Number(r?.lastPrice||0),u=Number(s.entryPrice||0),y=Number(s.quantity||0),g=Number(s.margin||0);let x=0;i>0&&(x=s.side==="long"?(i-u)*y:(u-i)*y);const de=g>0?x/g*100:0;return e.jsxs(c,{direction:"column",lh:1.2,children:[e.jsxs(t,{size:"xs",color:x>=0?"var(--green)":"var(--red)",fw:600,children:[x>=0?"+":"",x.toFixed(2)," ",a]}),e.jsxs(t,{size:"xxs",color:x>=0?"var(--green)":"var(--red)",children:["(",de>=0?"+":"",de.toFixed(2),"%)"]})]})}},{label:"Realized PNL",key:"realizedPnL",render:s=>{const r=Number(s.realizedPnL||0),i=Number(s.margin||s.marginToRelease||0),u=i>0?r/i*100:0;return e.jsxs(c,{direction:"column",lh:1.2,children:[e.jsxs(Q,{gap:4,children:[e.jsxs(t,{size:"xs",color:r>=0?"var(--green)":"var(--red)",fw:600,children:[r>=0?"+":"",r.toFixed(2)," ",a]}),s.note==="Liquidated"&&e.jsx(ue,{label:`Liquidated at ${s.exitPrice}`,children:e.jsx(he,{color:"var(--red)",size:"xs",variant:"filled",children:"LIQ"})})]}),e.jsxs(t,{size:"xxs",color:r>=0?"var(--green)":"var(--red)",children:["(",u>=0?"+":"",u.toFixed(2),"%)"]})]})}},{label:"TP/SL",key:"tpsl",render:s=>e.jsxs(c,{direction:"column",gap:2,lh:1,children:[e.jsxs(t,{size:"xxs",color:"var(--green)",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>ce(s),children:["TP: ",s.tpPrice>0?s.tpPrice:"--"," ",s.tpQuantity>0?`(${Math.round(s.tpQuantity/s.quantity*100)}%)`:""]}),e.jsxs(t,{size:"xxs",color:"var(--red)",style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>ce(s),children:["SL: ",s.slPrice>0?s.slPrice:"--"," ",s.slQuantity>0?`(${Math.round(s.slQuantity/s.quantity*100)}%)`:""]})]})},{label:"Close",key:"action",render:s=>e.jsx(m,{size:"compact-xs",color:"#fe445c",variant:"light",onClick:()=>z({symbol:s.symbol,totalQty:Number(s.quantity)}),children:"Close"})}]})}),e.jsx(p.Panel,{value:"orders",p:0,children:e.jsx(le,{data:R.filter(s=>s.symbol?.includes("_")),emptyMessage:"No recent orders",columns:[{label:"Symbol",key:"symbol",render:s=>e.jsxs(c,{direction:"column",lh:1.2,gap:0,children:[e.jsx(t,{size:"sm",fw:700,children:ae(s.symbol)}),e.jsxs(Q,{gap:2,children:[e.jsxs(t,{size:"xxs",c:"dimmed",fw:500,children:[s.leverage,"x"]}),e.jsx(t,{size:"xxs",color:s.side==="long"?"var(--green)":"var(--red)",fw:700,tt:"uppercase",children:s.side})]})]})},{label:"Size",key:"quantity",render:s=>Number(s.quantity).toFixed(4)},{label:"Price",key:"price"},{label:"Status",key:"status"},{label:"Time",key:"createdAt",render:s=>xe(s.createdAt)},{label:"Action",key:"action",render:s=>s.status==="pending"?e.jsx(m,{size:"compact-xs",color:"gray",variant:"light",onClick:()=>Pe(s._id),children:"Cancel"}):"-"}]})}),e.jsx(p.Panel,{value:"history",p:0,children:e.jsx(le,{data:fe,emptyMessage:"No trade history",columns:[{label:"Symbol",key:"symbol",render:s=>e.jsxs(c,{direction:"column",lh:1.2,gap:0,children:[e.jsx(t,{size:"sm",fw:700,children:ae(s.symbol)}),e.jsxs(Q,{gap:2,children:[e.jsxs(t,{size:"xxs",c:"dimmed",fw:500,children:[s.leverage,"x"]}),e.jsx(t,{size:"xxs",color:s.side==="long"?"var(--green)":"var(--red)",fw:700,tt:"uppercase",children:s.side})]})]})},{label:"Size",key:"quantity",render:s=>Number(s.quantity).toFixed(4)},{label:"Entry",key:"entryPrice"},{label:"Exit",key:"exitPrice"},{label:"Realized PnL",key:"realizedPnL",render:s=>{const r=Number(s.realizedPnL||0),i=Number(s.margin||s.marginToRelease||0),u=i>0?r/i*100:0;return e.jsxs(c,{direction:"column",lh:1.2,children:[e.jsxs(Q,{gap:4,children:[e.jsxs(t,{size:"xs",color:r>=0?"var(--green)":"var(--red)",fw:600,children:[r>=0?"+":"",r.toFixed(2)," ",a]}),s.note==="Liquidated"&&e.jsx(ue,{label:`Liquidated at ${s.exitPrice}`,children:e.jsx(he,{color:"var(--red)",size:"xs",variant:"filled",children:"LIQ"})})]}),e.jsxs(t,{size:"xxs",color:r>=0?"var(--green)":"var(--red)",children:["(",u>=0?"+":"",u.toFixed(2),"%)"]})]})}},{label:"Time",key:"time",render:s=>xe(s.createdAt||s.updatedAt||s.closedAt)}]})})]})})]})}),e.jsx(I.Col,{span:{base:12,lg:2},children:e.jsx(me,{token:d,quote:a,isAuthed:C,available:be,futuresPositions:T,onPlaceOrder:Se,onClosePosition:oe,onTransferClick:()=>J(!0),loadingOrder:Z})})]}),e.jsx(ne,{opened:!!b,onClose:()=>z(null),title:`Close Position: ${b?.symbol.replace("_","")}`,centered:!0,size:"sm",lockScroll:!1,children:e.jsxs(c,{direction:"column",gap:"md",py:"xs",children:[e.jsxs(t,{size:"sm",c:"dimmed",children:["Available to close: ",e.jsx(t,{component:"span",fw:600,c:"var(--mantine-color-text)",children:b?.totalQty})]}),e.jsx(N,{label:"Quantity to Close",placeholder:"0.00",value:$,onChange:s=>E(s.currentTarget.value),rightSection:e.jsx(t,{size:"xs",c:"dimmed",pr:"md",children:d})}),e.jsx(G,{value:ee,onChange:s=>{se(s),b&&E(s===100?b.totalQty.toString():(b.totalQty*s/100).toFixed(8).replace(/\.?0+$/,""))}}),e.jsx(m,{color:"#fe445c",fullWidth:!0,onClick:()=>oe(b.symbol,$),disabled:!$||parseFloat($)<=0,children:"Confirm Close"})]})}),e.jsx(qe,{opened:K,onClose:()=>J(!1),currentSide:"futures",asset:a,onTransferred:()=>{w()}}),e.jsx(ne,{opened:!!l,onClose:()=>f(null),title:`TP/SL Settings - ${l?.symbol.replace("_","")}`,centered:!0,size:"sm",lockScroll:!1,children:e.jsxs(pe,{gap:"md",children:[e.jsxs(L,{children:[e.jsx(t,{size:"sm",fw:600,color:"var(--green)",children:"Take Profit (TP)"}),e.jsxs(c,{direction:"column",gap:"sm",mt:"xs",children:[e.jsx(N,{label:"Trigger Price",placeholder:"0.00",value:o.tp,onChange:s=>A({...o,tp:s.currentTarget.value}),size:"xs"}),e.jsx(N,{label:"Quantity to Close",placeholder:"All",value:o.tpQty,onChange:s=>A({...o,tpQty:s.currentTarget.value}),size:"xs"}),e.jsx(G,{value:U.tp,onChange:s=>{re({...U,tp:s});const r=s===100?l.totalQty:l.totalQty*s/100;A({...o,tpQty:r>0?r.toFixed(8).replace(/\.?0+$/,""):""})}})]})]}),e.jsxs(L,{children:[e.jsx(t,{size:"sm",fw:600,color:"var(--red)",children:"Stop Loss (SL)"}),e.jsxs(c,{direction:"column",gap:"sm",mt:"xs",children:[e.jsx(N,{label:"Trigger Price",placeholder:"0.00",value:o.sl,onChange:s=>A({...o,sl:s.currentTarget.value}),size:"xs"}),e.jsx(N,{label:"Quantity to Close",placeholder:"All",value:o.slQty,onChange:s=>A({...o,slQty:s.currentTarget.value}),size:"xs"}),e.jsx(G,{value:U.sl,onChange:s=>{re({...U,sl:s});const r=s===100?l.totalQty:l.totalQty*s/100;A({...o,slQty:r>0?r.toFixed(8).replace(/\.?0+$/,""):""})}})]})]}),e.jsxs(Q,{grow:!0,mt:"md",children:[e.jsx(m,{variant:"light",color:"gray",onClick:()=>f(null),children:"Cancel"}),e.jsx(m,{fullWidth:!0,color:"blue",onClick:()=>{if(l){const s=l.symbol,r=h.get(s)||h.get(s.replace("_","")),i=parseFloat(r?.lastPrice||"0"),u=T.find(y=>y.symbol===s);if(i>0&&u){const y=u.side==="long",g=parseFloat(o.tp),x=parseFloat(o.sl);if(g>0){if(y&&g<=i){v.show({title:"Invalid TP",message:`Long TP (${g}) must be higher than current price (${i})`,color:"red"});return}if(!y&&g>=i){v.show({title:"Invalid TP",message:`Short TP (${g}) must be lower than current price (${i})`,color:"red"});return}}if(x>0){if(y&&x>=i){v.show({title:"Invalid SL",message:`Long SL (${x}) must be lower than current price (${i})`,color:"red"});return}if(!y&&x<=i){v.show({title:"Invalid SL",message:`Short SL (${x}) must be higher than current price (${i})`,color:"red"});return}}}Ce(l.symbol,o.tp,o.sl,o.tpQty,o.slQty)}},children:"Confirm TP/SL"})]})]})})]})}export{Je as default};
